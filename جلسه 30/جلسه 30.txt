این جلسه: اضافه کردن عکس
فایل هایی که ما (توسعه دهنده) داخل سرور میذاریم و ازشون توی صفحه مون استفاده میکینم بهشون میگن استاتیک فایل.
فایل هایی که کاربر آپلود میکنه و میذاره روی سرور ما بهش میگن مدیا.
فایل های استاتیک که خودمون گذاشتیم امنه.
ولی فایل های مدیا شاید ویروس باشه و مشکل داشته باشه.
خلاصه.
برای کار کردن با مدیا فایل ها، مراحل زیر رو باید انجام بدیم:
1- نصب پکیج پیلو
2- اضافه کردن دو خط زیر در ستینگز دات پای
MEDIA_URL = "media/"
MEDIA_ROOT = str(BASE_DIR.joinpath('media'))
3- داخل روت اصلی پروژه، پوشه مدیا رو اضافه میکنیم.
حالا اگه عکس هامون زیاد هست و خواستیم دسته بندی کنیم داخل همون رو هم پوشه بندی میکنیم.
مثلا تو این پروژه پوشه covers رو ساختیم.
4- در فایل یو آر ال تنظیمات اولیه پروژه (کانفیگ) این دو تا ایمپورت رو اضافه میکنیم.
from django.conf import settings
from django.conf.urls.static import static
و بعد آخر urlpatterns، این رو اضافه میکنیم. یعنی میشه این شکلی:
5-
from django.contrib import admin
from django.urls import path, include
from django.conf import settings
from django.conf.urls.static import static

urlpatterns = [
    path('admin/', admin.site.urls),
    path('', include('pages.urls')),
    path('accounts/', include('django.contrib.auth.urls')),
    path('accounts/', include('accounts.urls')),
    path('books/', include('books.urls')),
] + static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
نکته: این داره از همونا استفاده میکنه. چرا مستقیم نمینویسیم؟
چون موقع دیپلوی نهایی لازم نیست این قسمت + بعد از لیست رو دیگه بنویسیم. اونجا به این فایل ها خودش دسترسی داره و اوکی هست.
این موقع دولوپمنت هست که این کار رو میکنیم. به خاطر همین بود که مستقیما نیومدیم اینجا و دستی داخل تابع ننوشتیم
] + static("media/", document_root="str(BASE_DIR.joinpath('media'))")
این ها حفظی هست و میشه سرچ هم کرد جلوی بچه ها.
مراحلش تموم شد.
حالا بریم تو مدلمون ایمیج فیلد هم اضافه کنیم به مدلمون. و آپلود تو رو بگم.
موقع makemigrations، بهمون هشدار میده (نه ارور) و میگه با قبلی ها که NN هستند و مقدار پیش فرض ندارند چیکار کنم؟
ما هم بهش میگیم چی کار کنه. مثلا بهش میگیم blank=True باشه.
بعدش makemigrations و migrate رو میزنیم و بعد از توی ادمین میتونیم کاور ها رو ویرایش کنیم.
کاورها رو هم واقعی بذارم و عوض کنیم.
برای نمایش توی سایتمون هم که این شکلی هست.
src="{{ book.cover.url }}"
کتاب هایی که عکس نذاشتیم ارور میده. پس توی ایف میذاریمش که اگه نبود یه عکس ثابت بیاره مثلا.
توی صفحه اصلی هم همین کار رو بکنیم.


یادآوری:
خودش موقع اضافه کردن
MEDIA_URL = "media/"
تاکید داشت که دو طرفش اسلش باشه یعنی این شکلی
MEDIA_URL = "/media/"
ولی من همون شکلی نوشتم کار کرد. فقط نوشتم گوشه ذهنم باشه اگه کار نکرد شاید به خاطر این باشه.